import React, { useState } from "react";
import { Link, useNavigate } from "react-router-dom";
import "./navbar.css"
import "../styles/svgIcons.css"

let user = JSON.parse(localStorage.getItem("user"));
console.log(localStorage.getItem("user"));
let role = user?.role;
/* console.log(user.email) */

let userEmail = user?.email;
let photoUser = user?.photo;

function NavBar({ cartCount }) {
  let token = localStorage.getItem("token");
  console.log(token);
  const [showSidebar, setShowSidebar] = useState(false);
  const [isOpen, setIsOpen] = useState(false);
  let navigate = useNavigate();

  const isLoggedIn = () => {
    const token = localStorage.getItem("token");
    const email = localStorage.getItem("email");
    const photo = localStorage.getItem("photo");
    return token && email && photo;
  };

  const signout = async () => {
    const token = localStorage.getItem("token");
    const headers = { headers: { Authorization: `Bearer ${token}` } };

    try {
      await api.post(apiUrl + endpoints.signout, null, headers);
      localStorage.removeItem("token");
      localStorage.removeItem("email");
      localStorage.removeItem("photo");
      navigate("/");
    } catch (error) {
      alert("¡Error al cerrar sesión!");
    }
  };

  const toggleNavbar = () => {
    console.log("Button clicked"); // Add this line
    setIsOpen(!isOpen);
  };

  const closeNavbar = () => {
    setIsOpen(false);
  };

  const logout = () => {
    navigate("/");
    localStorage.removeItem("user");
    localStorage.removeItem("photo");
    localStorage.removeItem("token");
  };

  return (

    <nav className={`my-navbar ${isOpen ? "nav-open" : ""}`}>
      <img className="g4a-logo" src="public\logo.png" alt="Logo" />
      {isLoggedIn() ? (
        <div className="user-info">
          <img className="user-photo" src={localStorage.getItem("photo")}/>
          <p>{localStorage.getItem("name")}</p>
        </div>
      ) : (
        <div className="nav-container">
          <Link to="/" className="nav-link">
            <img src="public\Vector.png" alt="" />
            <p className="">Home</p>
          </Link>
          <Link to="/register" className="nav-link">
            <img src="public\bi_people.svg" className="homeimg" alt="" />
            <p className="">Register</p>
          </Link>
          <Link to="/signin" className="nav-link">
            <img src="public\bi_people.svg" alt="" />
            <p className="">Sign In</p>
          </Link>
        </div>
      )}
      {isLoggedIn() && (
        <div className="nav-container">
          <Link to="/" className="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" 
            className="svg-icon" viewBox="0 0 16 16"> 
            <path className="fill-1" d="M2 13.5V7h1v6.5a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V7h1v6.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5zm11-11V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"/> <path d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z"
            stroke="#fff"/> 
            </svg>
            <p className="">Home</p>
          </Link>

          <Link to="/games" className="nav-link">
            <svg className="svg-icon" viewBox="0 0 43 43" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path id="Vector" d="M27.5746 8.88235H15.7069C8.06014 8.88235 1.86121 16.0721 1.86121 24.9412C1.86121 33.8102 8.06014 41 15.7069 41H27.5746C35.2214 41 41.4203 33.8102 41.4203 24.9412C41.4203 16.0721 35.2214 8.88235 27.5746 8.88235Z" 
              stroke="#7D8085"
              className="stroke-1"/>

              <path id="Vector_2" d="M9.77304 24.9412H19.6628M9.77304 24.9412H19.6628M21.6408 2V8.88235M21.6408 2V8.88235M14.7179 19.2059V30.6765" 
              stroke="#7D8085"
              className="stroke-2"/>
            </svg>
            <p className="">Games</p>
          </Link>


          <Link to="/market" className="nav-link">
            <svg className="svg-icon" viewBox="0 0 48 38" 
              fill="none" xmlns="http://www.w3.org/2000/svg">
              <path id="Vector" className="fill-1"
              d="M44.2722 11.2459L11.8805 8.07531L9.90588 1.45737C9.83724 1.2354 9.68837 1.03941 9.482 0.899296C9.27563 0.759185 9.0231 0.68266 8.76295 0.681402H3.90041C3.72467 0.472141 3.49653 0.301722 3.23387 0.183502C2.97121 0.0652829 2.68116 0.00247481 2.38647 0C1.86883 0 1.37238 0.181893 1.00635 0.505665C0.640325 0.829438 0.434692 1.26857 0.434692 1.72645C0.434692 2.18433 0.640325 2.62346 1.00635 2.94724C1.37238 3.27101 1.86883 3.4529 2.38647 3.4529C3.01531 3.4529 3.54669 3.17478 3.90356 2.76872H7.8527L16.0748 30.3029C15.1779 31.1474 14.6777 32.262 14.6757 33.4207C14.675 34.0221 14.8085 34.6177 15.0683 35.1735C15.3282 35.7292 15.7093 36.2342 16.19 36.6595C16.6707 37.0848 17.2415 37.4221 17.8697 37.6521C18.4979 37.8822 19.1712 38.0004 19.8511 38C21.2248 38.0004 22.5424 37.5182 23.5144 36.6595C24.4864 35.8008 25.0331 34.6358 25.0343 33.4207C25.0316 33.0724 24.9825 32.7256 24.8881 32.3875H33.5866C33.4935 32.7258 33.445 33.0725 33.442 33.4207C33.442 35.9516 35.7624 38 38.6236 38C41.4849 38 43.8006 35.9516 43.8006 33.4207C43.801 32.2053 43.2557 31.0396 42.2846 30.1798C41.3135 29.32 39.9961 28.8366 38.6221 28.8358C37.1286 28.8358 35.7923 29.406 34.8459 30.3002H23.6273C23.1458 29.8392 22.5619 29.4711 21.9121 29.2191C21.2622 28.9672 20.5606 28.8367 19.8511 28.8358C19.2537 28.8358 18.6908 28.9443 18.1579 29.1084L17.8718 28.1544H40.7979C41.6789 28.1385 42.5284 27.8611 43.2098 27.3668C43.8912 26.8725 44.3651 26.19 44.5552 25.4288L47.0313 14.5848C47.073 14.3951 47.0941 14.2023 47.0942 14.0091C47.0954 13.3207 46.8072 12.6565 46.2857 12.1456C45.7642 11.6347 45.0465 11.3135 44.2722 11.2445V11.2459ZM38.6252 33.8295C38.502 33.8292 38.384 33.7859 38.2966 33.7092C38.2092 33.6324 38.1595 33.5282 38.1583 33.4193C38.163 33.1885 38.3705 33.0049 38.6268 33.0049C38.883 33.0049 39.0906 33.1885 39.0937 33.4179C39.0921 33.5266 39.0422 33.6304 38.9548 33.7069C38.8675 33.7833 38.7497 33.8264 38.6268 33.8268L38.6252 33.8295ZM41.4236 23.4069L42.9139 22.0858L42.414 24.283L41.4236 23.4069ZM18.7018 10.8399L20.329 12.2833L18.301 14.0772L16.2682 12.2833L17.9771 10.7703L18.7003 10.8399H18.7018ZM25.7732 11.5324L26.619 12.2833L24.591 14.0772L22.5582 12.2833L23.6398 11.3238L25.7748 11.5324H25.7732ZM13.789 14.4749L15.1567 13.2679L17.1848 15.0646L15.1567 16.8584L14.2685 16.0755L13.7906 14.4735L13.789 14.4749ZM13.3252 12.9174L12.8096 11.1931L14.0437 12.2847L13.3252 12.9188V12.9174ZM32.9059 17.8458L30.8778 19.6397L28.8451 17.8458L30.8763 16.0477L32.9043 17.8444L32.9059 17.8458ZM31.9893 15.0646L34.0205 13.2679L36.0485 15.0646L34.0205 16.8612L31.9878 15.0646H31.9893ZM27.7336 16.8584L25.7009 15.0646L27.7321 13.2665L29.7601 15.0632L27.7321 16.8571L27.7336 16.8584ZM26.6174 17.8458L24.5894 19.6397L22.5582 17.8458L24.5894 16.0477L26.6174 17.8444V17.8458ZM21.4452 16.8584L19.4124 15.0646L21.4436 13.2665L23.4716 15.0632L21.4436 16.8571L21.4452 16.8584ZM20.329 17.8458L18.301 19.6397L16.2682 17.8458L18.2994 16.0477L20.3274 17.8444L20.329 17.8458ZM15.1567 18.829L17.1848 20.6256L15.9522 21.7145L15.1033 18.8721L15.1552 18.8262L15.1567 18.829ZM16.4176 23.2748L18.2994 21.6102L20.3274 23.4069L18.2994 25.2008L16.5229 23.6294L16.416 23.2734L16.4176 23.2748ZM19.414 20.6256L21.442 18.8276L23.4748 20.6242L21.4468 22.4181L19.4156 20.6242L19.414 20.6256ZM24.5894 21.6088L26.6206 23.4055L24.5894 25.1994L22.5582 23.4055L24.5894 21.6074V21.6088ZM25.7025 20.6242L27.7336 18.8262L29.7617 20.6229L27.7336 22.4167L25.7025 20.6229V20.6242ZM30.8747 21.6074L32.9074 23.4041L30.8794 25.198L28.8483 23.4013L30.8763 21.6074H30.8747ZM31.9909 20.6229L34.0189 18.8248L36.0517 20.6215L34.0236 22.4154L31.9909 20.6215V20.6229ZM35.1351 17.8416L37.1631 16.0435L39.1959 17.8402L37.1679 19.6341L35.1351 17.8402V17.8416ZM38.2794 15.0604L40.3074 13.2623L42.3385 15.0646L40.3105 16.8612L38.2778 15.0632L38.2794 15.0604ZM37.1631 14.0758L35.3474 12.4683L38.6205 12.7881L37.1647 14.0758H37.1631ZM32.909 12.2833L30.881 14.08L28.8483 12.2833L29.3042 11.88L32.8461 12.2277L32.909 12.2833ZM21.4483 11.296L21.2094 11.0874L21.6385 11.1291L21.4499 11.296H21.4483ZM15.1599 11.2988L14.138 10.3949L15.9774 10.5756L15.1599 11.2988ZM21.4483 24.3914L23.3427 26.0671H19.5539L21.4483 24.3914ZM27.7368 24.3914L29.6312 26.0685H25.8392L27.7352 24.3914H27.7368ZM34.0252 24.3914L35.9228 26.0699H32.1277L34.0236 24.3914H34.0252ZM35.1367 23.4069L37.1679 21.6088L39.1959 23.4055L37.1679 25.1994L35.1351 23.4055L35.1367 23.4069ZM38.2809 20.6256L40.3121 18.829L42.3401 20.6229L40.3121 22.4209L38.2794 20.627L38.2809 20.6256ZM43.4563 19.6383L41.4251 17.8444L43.4532 16.0477L44.1528 16.6652L43.4767 19.6188L43.4547 19.6397L43.4563 19.6383ZM44.2424 13.3805L43.4563 14.0758L42.4187 13.1622L44.0176 13.3179C44.1025 13.3291 44.1748 13.3541 44.2439 13.3791L44.2424 13.3805ZM19.8542 33.8281C19.7353 33.822 19.6235 33.7759 19.5417 33.6993C19.4599 33.6226 19.4144 33.5212 19.4144 33.4158C19.4144 33.3104 19.4599 33.209 19.5417 33.1324C19.6235 33.0557 19.7353 33.0096 19.8542 33.0035C19.9727 33.0096 20.0842 33.0556 20.1656 33.132C20.2471 33.2084 20.2925 33.3094 20.2925 33.4144C20.2925 33.5195 20.2471 33.6205 20.1656 33.6969C20.0842 33.7733 19.9727 33.8193 19.8542 33.8254V33.8281ZM40.7994 26.0685H38.4146L40.3121 24.39L41.7742 25.6833C41.4802 25.9197 41.1091 26.0866 40.7994 26.0685Z" 
              fill="white"/>
            </svg>
            <p className="">Store</p>
          </Link>


          <Link to="/adminPanel" className="nav-link">
          <svg className="svg-icon" viewBox="0 0 30 29" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path id="Vector" className="fill-1"
            d="M28.125 25.375C28.125 25.375 30 25.375 30 23.5625C30 21.75 28.125 16.3125 20.625 16.3125C13.125 16.3125 11.25 21.75 11.25 23.5625C11.25 25.375 13.125 25.375 13.125 25.375H28.125ZM13.1662 23.5625C13.1524 23.5607 13.1386 23.5582 13.125 23.5553C13.1269 23.0767 13.4381 21.6884 14.55 20.4377C15.585 19.2651 17.4037 18.125 20.625 18.125C23.8444 18.125 25.6631 19.2669 26.7 20.4377C27.8119 21.6884 28.1213 23.0786 28.125 23.5553L28.11 23.5589C28.1013 23.5603 28.0925 23.5615 28.0837 23.5625H13.1662ZM20.625 12.6875C21.6196 12.6875 22.5734 12.3056 23.2766 11.6258C23.9799 10.9459 24.375 10.0239 24.375 9.0625C24.375 8.10109 23.9799 7.17906 23.2766 6.49924C22.5734 5.81942 21.6196 5.4375 20.625 5.4375C19.6304 5.4375 18.6766 5.81942 17.9734 6.49924C17.2701 7.17906 16.875 8.10109 16.875 9.0625C16.875 10.0239 17.2701 10.9459 17.9734 11.6258C18.6766 12.3056 19.6304 12.6875 20.625 12.6875ZM26.25 9.0625C26.25 9.77656 26.1045 10.4836 25.8218 11.1433C25.5391 11.803 25.1248 12.4025 24.6025 12.9074C24.0801 13.4123 23.4601 13.8128 22.7776 14.0861C22.0951 14.3594 21.3637 14.5 20.625 14.5C19.8863 14.5 19.1549 14.3594 18.4724 14.0861C17.7899 13.8128 17.1699 13.4123 16.6475 12.9074C16.1252 12.4025 15.7109 11.803 15.4282 11.1433C15.1455 10.4836 15 9.77656 15 9.0625C15 7.62039 15.5926 6.23734 16.6475 5.21761C17.7024 4.19788 19.1332 3.625 20.625 3.625C22.1168 3.625 23.5476 4.19788 24.6025 5.21761C25.6574 6.23734 26.25 7.62039 26.25 9.0625ZM13.005 16.82C12.255 16.5917 11.4818 16.4416 10.6987 16.3723C10.2587 16.3319 9.81699 16.3119 9.375 16.3125C1.875 16.3125 0 21.75 0 23.5625C0 24.7714 0.624375 25.375 1.875 25.375H9.78C9.50204 24.8092 9.36342 24.1888 9.375 23.5625C9.375 21.7319 10.0819 19.8614 11.4188 18.299C11.8744 17.7661 12.405 17.2677 13.005 16.82ZM9.225 18.125C8.11529 19.7368 7.51583 21.6264 7.5 23.5625H1.875C1.875 23.0912 2.1825 21.6956 3.3 20.4377C4.32188 19.285 6.0975 18.1613 9.225 18.1268V18.125ZM2.8125 9.96875C2.8125 8.52664 3.40513 7.14359 4.46002 6.12386C5.51492 5.10413 6.94566 4.53125 8.4375 4.53125C9.92934 4.53125 11.3601 5.10413 12.415 6.12386C13.4699 7.14359 14.0625 8.52664 14.0625 9.96875C14.0625 11.4109 13.4699 12.7939 12.415 13.8136C11.3601 14.8334 9.92934 15.4062 8.4375 15.4062C6.94566 15.4062 5.51492 14.8334 4.46002 13.8136C3.40513 12.7939 2.8125 11.4109 2.8125 9.96875ZM8.4375 6.34375C7.44294 6.34375 6.48911 6.72567 5.78585 7.40549C5.08259 8.08531 4.6875 9.00734 4.6875 9.96875C4.6875 10.9302 5.08259 11.8522 5.78585 12.532C6.48911 13.2118 7.44294 13.5938 8.4375 13.5938C9.43206 13.5938 10.3859 13.2118 11.0892 12.532C11.7924 11.8522 12.1875 10.9302 12.1875 9.96875C12.1875 9.00734 11.7924 8.08531 11.0892 7.40549C10.3859 6.72567 9.43206 6.34375 8.4375 6.34375Z"/>
          </svg>

            <p className="">Admin </p>
          </Link>
          <button onClick={signout} className="nav-link">
            <svg className="svg-icon"
                viewBox="0 0 43 35" fill="none" 
                xmlns="http://www.w3.org/2000/svg"
                >
                    <path id="Vector" 
                    d="M17.9167 4.375H5.375V14.5833H17.9167V4.375ZM17.9167 20.4167H5.375V30.625H17.9167V20.4167ZM37.625 4.375H25.0833V14.5833H37.625V4.375Z" 
                    fill= "#888"
                    className="fill-1"/>
                    
                    <path id="Vector_2" 
                    d="M25.0834 20.4167L37.625 30.625M25.0834 20.4167H37.625H25.0834ZM25.0834 20.4167V30.625V20.4167Z" 
                    stroke="#fff"
                    className="stroke-2"/>
            </svg>
            <p>Log Out</p>
          </button>
        </div>
      )}
      <button 
      id="openClose" 
      className={`btn-nav lg:hidden ${isOpen ? "" : "btn-open"}`}
      onClick={toggleNavbar}>
        <svg xmlns="http://www.w3.org/2000/svg" className="svg-icon" viewBox="0 0 50 50">
          <path className="fill-2 stroke-2" d="M 3 8 A 2.0002 2.0002 0 1 0 3 12 L 47 12 A 2.0002 2.0002 0 1 0 47 8 L 3 8 z M 3 23 A 2.0002 2.0002 0 1 0 3 27 L 47 27 A 2.0002 2.0002 0 1 0 47 23 L 3 23 z M 3 38 A 2.0002 2.0002 0 1 0 3 42 L 47 42 A 2.0002 2.0002 0 1 0 47 38 L 3 38 z"></path>
        </svg>
      </button>
    </nav>

  );
}
export default NavBar;
